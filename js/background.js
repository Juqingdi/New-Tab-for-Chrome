function getPreview(a){return new Promise((b)=>{const c=new Image;return a?void(c.src='https://mini.s-shot.ru/1366x890/400/png/?'+a,c.onload=()=>{const a=document.createElement('canvas');a.width=c.width,a.height=c.height;const d=a.getContext('2d');d.drawImage(c,0,0,a.width,a.height);const e=a.toDataURL('image/png');b(e)},c.onerror=()=>b(null)):b(null)})}function initBookmarks(){chrome.topSites.get((a)=>{let b=a.filter((a)=>'chrome'!==a.url.slice(0,6)&&!a.url.includes('localhost')).slice(0,10).map((a,b)=>({id:b,url:a.url,title:a.title||'',img:''}));chrome.storage.local.set({bookmarks:b});const c=b.map((a)=>getPreview(a.url));Promise.all(c).then((a)=>{b=b.map((c,b)=>(c.img=a[b],c)),chrome.storage.local.set({bookmarks:b}),chrome.runtime.sendMessage({action:'reload-storage'})})})}chrome.browserAction.onClicked.addListener(()=>chrome.tabs.create({})),chrome.runtime.onInstalled.addListener((a)=>{'install'===a.reason&&initBookmarks()});